<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Content Manager</title>

  <link rel="stylesheet" href="https://unpkg.com/netlify-cms@^1.0.0/dist/cms.css" />

</head>

<body>
    <table>
        <thead>
            <tr>
                <th>Data</th>
                <th>Luogo</th>
                <th>Numero</th>
            </tr>
        </thead>
        <tbody id="table-body">
                  </tbody>
        <tfoot>
            <tr>
                <th>Totale Somma:</th>
                <th colspan="2" id="total-sum">0</th>
            </tr>
        </tfoot>
    </table>
    <button onclick="aggiungiRiga()">Aggiungi riga</button>

    <div>
        <label for="filter-date">Filtra per data:</label>
        <input type="date" id="filter-date" onchange="filtraPerData()" />
    </div>
    <br>
<!-- <form action="postdovenonso" method="post">
    <div><label for="Nome">Il tuo nome </label><input type="text" Nome="Nome" placeholder="inserisci il tuo nome">
    </div>
    <div><label for="Cognome"> Scrivi il tuo cognome <input type="text" Nome="Cognome"
                placeholder="inserisci il tuo cognome"></label></div>
    <div><label for="email">scrivi la tua email </label><input type="email" placeholder="email"></div>
    <div><label for="spesa">importo spese </label><input type="number" placeholder="spesa"></div>
    <div><label for="regione">La tua regione <select name="regione">
                <option value="Veneto">Veneto</option>
                <option value="Lazio">Lazio</option>
                <option value="Campania">Campania</option>
            </select></div>
    <div>Età 0 - 18 <input type="radio"> Età > 18 <input type="radio"></div>
    <div>
        <input type="checkbox">Accetta condizioni
    </div>
    <div><input type="submit" value="INVIA"></div> -->
    <script src="https://unpkg.com/netlify-cms@^1.0.0/dist/cms.js"></script>
    <script>
        function calcolaSommaTotale() {
            const numeri = document.querySelectorAll("#table-body input.numero");
            let totalSum = 0;

            numeri.forEach(numero => {
                const value = parseFloat(numero.value);
                if (!isNaN(value)) {
                    totalSum += value;
                }
            });

            document.getElementById("total-sum").textContent = totalSum;

            // Salva i dati nella memoria locale
            const datiTabella = [];
            const righe = document.querySelectorAll("#table-body tr");
            righe.forEach(riga => {
                const data = riga.querySelector("td:first-child input").value;
                const testo = riga.querySelector("td:nth-child(2) input").value;
                const numero = riga.querySelector("td:nth-child(3) input").value;

                datiTabella.push({ data, testo, numero });
            });

            localStorage.setItem("datiTabella", JSON.stringify(datiTabella));
        }

        function calcolaSommaPerData(dataFiltraggio) {
            const numeri = document.querySelectorAll("#table-body input.numero");
            let totalSum = 0;

            numeri.forEach(numero => {
                const riga = numero.closest("tr");
                const dataCell = riga.querySelector("td:first-child");
                const data = dataCell.querySelector("input").value;

                if (data <= dataFiltraggio) {
                    const value = parseFloat(numero.value);
                    if (!isNaN(value)) {
                        totalSum += value;
                    }
                    riga.style.display = "table-row";
                } else {
                    riga.style.display = "none";
                }
            });

            document.getElementById("total-sum").textContent = totalSum;
        }

        function caricamentoIniziale() {
            // Controlla se ci sono dati salvati e li ripristina
            const datiSalvati = localStorage.getItem("datiTabella");
            if (datiSalvati) {
                const datiTabella = JSON.parse(datiSalvati);

                datiTabella.forEach(dato => {
                    const { data, testo, numero } = dato;
                    const tableBody = document.getElementById("table-body");

                    const row = document.createElement("tr");
                    const dataCell = document.createElement("td");
                    const testoCell = document.createElement("td");
                    const numeroCell = document.createElement("td");

                    const dataInput = document.createElement("input");
                    dataInput.type = "date";
                    dataInput.value = data;

                    const testoInput = document.createElement("input");
                    testoInput.type = "text";
                    testoInput.value = testo;

                    const numeroInput = document.createElement("input");
                    numeroInput.type = "number";
                    numeroInput.classList.add("numero");
                    numeroInput.value = numero;
                    numeroInput.addEventListener("input", calcolaSommaTotale);

                    dataCell.appendChild(dataInput);
                    testoCell.appendChild(testoInput);
                    numeroCell.appendChild(numeroInput);

                    row.appendChild(dataCell);
                    row.appendChild(testoCell);
                    row.appendChild(numeroCell);
                    tableBody.appendChild(row);
                });

                calcolaSommaTotale(); // Aggiorna la somma totale
            }
        }

        // Funzione per filtrare i dati per data
        function filtraPerData() {
            const filterDate = document.getElementById("filter-date").value;
            calcolaSommaPerData(filterDate);
        }

        // Funzione per aggiungere una nuova riga alla tabella
        function aggiungiRiga() {
            const tableBody = document.getElementById("table-body");

            const row = document.createElement("tr");
            const dataCell = document.createElement("td");
            const testoCell = document.createElement("td");
            const numeroCell = document.createElement("td");

            const dataInput = document.createElement("input");
            dataInput.type = "date";

            const testoInput = document.createElement("input");
            testoInput.type = "text";

            const numeroInput = document.createElement("input");
            numeroInput.type = "number";
            numeroInput.classList.add("numero");
            numeroInput.addEventListener("input", calcolaSommaTotale);

            dataCell.appendChild(dataInput);
            testoCell.appendChild(testoInput);
            numeroCell.appendChild(numeroInput);

            row.appendChild(dataCell);
            row.appendChild(testoCell);
            row.appendChild(numeroCell);
            tableBody.appendChild(row);

            calcolaSommaTotale(); // Aggiorna la somma totale
        }

        document.addEventListener("DOMContentLoaded", function () {
            caricamentoIniziale(); // Carica i dati salvati all'avvio
        });
    </script>
  <script src="https://unpkg.com/netlify-cms@^1.0.0/dist/cms.js"></script>
</body>

</html>
